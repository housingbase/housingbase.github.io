<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="/image/favicon.png" type="image/png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/image/apple-touch-icon.png" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet" />
  <title>Home | HousingBase</title>

  <style>
    body {
      overflow-x: hidden;
    }

    #typedText {
      font-family: monospace;
      background-color: rgb(19, 19, 19);
      color: rgb(236, 236, 236);
      white-space: nowrap;
      z-index: 3;
    }

    #typewriter {
      white-space: nowrap;
      display: inline-block;
      background-color: rgb(19, 19, 19);
      padding-right: 7px;
      padding-left: 2px;
      z-index: 3;
    }

    #cursor {
      display: inline-block;
      opacity: 1;
      animation: blink 1s step-start infinite;
    }

    #cursor.hidden {
      opacity: 0;
    }

    @keyframes blink {

      0%,
      50%,
      100% {
        opacity: 1;
      }

      25%,
      75% {
        opacity: 0;
      }
    }
  </style>
</head>

<body>
  <div class="dot-background"></div>
  <header>
    <div class="logo"><img src="image/blueblue.png"></div>
    <div class="hamburger">
      <span></span>
      <span></span>
      <span></span>
    </div>
    <nav class="nav-links">
      <a href="/housing.html">Housing Browser</a>
      <a href="/news.html">News</a>
      <a href="/browser.html">HTSL Library</a>
      <a href="/dashboard.html">Dashboard</a>
      <a href="/projects.html">Projects</a>
      
      <div id="logged-in" style="display:flex; align-items:center;">
        <button href="login.html" class="nav-btn">Sign In</button>
      </div>
      <div id="logged-out" style="display:none; align-items:center;">
        <img id="avatarSmall" width="32" height="32" alt="Avatar" style="border-radius:6px; cursor:pointer; margin-left:8px;">
        <span id="displayName" style="margin-left:8px; font-weight:bold; color:#fff; cursor:pointer; display: none;"></span>
      </div>
    </nav>
  </header>

  <main class="hero">
    <div class="hero-text">
      <h1>Housing<span class="editor-title">Base</span></h1>
      <p class="subtitle" id="typewriter">
        <span id="typedText"></span><span id="cursor">_</span>
      </p>
      <p class="description">
        The <span class="highlighttxt">#1 website</span> for Housing creators!<br />
      </p>
      <div class="feature-tags">
        <span>Upload HTSL</span>
        <span>Download HTSL</span>
        <span>cool stuff</span>
        <span>Keep your private code organized</span>
        <span>Housing Tools</span>
        <span>Online Color Code Tester</span>
        <span>Browse Hypixel Housing online</span>
      </div>
      <div class="index-buttons">
        <button class="primary-btn">Primary</button>
        <button class="secondary-btn">Secondary</button>
      </div>
    </div>
    <div class="hero-image"></div>
  </main>

  <section class="promo">
    <h2>Upload and share <span class="highlight">HTSL.</span></h2>
    <h3>Distribute, upload and share your creations with our custom <a href="browser.html">HTSL Library</a>.</h3>

  </section>
  <div class="center">
    <txt class="txte">Browse <span class="highlighttxt">HTSL creations</span> uploaded by our users.</txt>
  </div>
  <section class="addon-ticker-section">
    <div class="addon-ticker" id="addonTicker"></div>
  </section>
  <section class="promo">
    <h2>Browse <span class="highlight">Hypixel Housing.</span></h2>
    <h3>Discover active housings on hypixel with our <a href="browser.html">Housing Browser</a>.</h3>

  </section>

  <div class="section2"></div>

  <footer class="footer">
    <div class="footer-container">
      <div class="footer-top">
        <img src="/image/fullwhite.png" alt="HousingBase Logo" class="footer-logo" />
        <div class="social-icons">
          <a href="https://www.youtube.com/@spigotbase" target="_blank" aria-label="YouTube">
            <i class="fab fa-youtube"></i>
          </a>
          <a href="https://github.com/spigotbase" target="_blank" aria-label="GitHub">
            <i class="fab fa-github"></i>
          </a>
        </div>
      </div>
      <div class="footer-links">
        <a href="/index.html">About</a>
        <a href="/contact.html">Contact</a>
        <a href="/terms.html">Terms</a>
      </div>
      <p class="footer-credit">&copy; 2025 <b>HousingBase</b>. All Rights Reserved</p>
    </div>
  </footer>

  <!-- Modal -->
  <div id="modal-overlay">
    <div id="modal-box">
      <div class="modal-header">
        <h3 id="modal-title"></h3>
        <span id="modal-close">&times;</span>
      </div>
      <div class="modal-body">
        <p id="modal-desc"></p>
        <a id="modal-download" style="text-decoration: none; margin-top: 10px; margin-bottom: 10px;"
          class="primary-btn">Download File
        </a>
        <h4>Code Contents:</h4>
      </div>
    </div>
  </div>

  <div id="del-confirm-overlay" class="del-modal-overlay">
    <div id="del-confirm-box" class="del-modal-box">
      <div class="del-modal-header">
        <h3>Confirm Action?</h3>
        <span id="del-confirm-close" class="del-modal-close">&times;</span>
      </div>
      <div class="del-modal-body">
        <p id="del-confirm-desc">Are you sure you want to delete '<Addon Name>'?</p>
        <div style="margin-top:12px; display:flex; gap:10px;">
          <button id="del-confirm-yes" class="primary-btn">Confirm</button>
          <button id="del-confirm-no" class="del-btn">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = "https://bytebukkit-server.onrender.com";

    function avatarURL(path) {
      if (!path || path.length === 0) return `${API_BASE}/uploads/avatars/default.png`;
      if (path.startsWith("http")) return path;
      return `${API_BASE}/${path.replace(/^\/?/, "")}`;
    }
    async function startRealAddonTicker(speed = 2) {
      const ticker = document.getElementById("addonTicker");
      if (!ticker) return;

      try {
        const token = localStorage.getItem("authToken");
        const res = await fetch(`${API_BASE}/api/addons`, {
          headers: { Authorization: `Bearer ${token}` },
        });
        if (!res.ok) throw new Error("Failed to fetch addons");
        const addons = await res.json();
        if (!addons.length) return;

        ticker.innerHTML = "";

        const createItem = (a) => {
          const item = document.createElement("div");
          item.className = "addon-ticker-item";

          const avatar = document.createElement("img");
          avatar.src = avatarURL(a.avatar);
          item.appendChild(avatar);

          const name = document.createElement("div");
          name.className = "addon-name";
          name.textContent = a.name.length > 15 ? a.name.slice(0, 15) + "…" : a.name;
          item.appendChild(name);

          const desc = document.createElement("div");
          desc.className = "addon-desc";
          desc.textContent = a.description
            ? (a.description.length > 15 ? a.description.slice(0, 15) + "…" : a.description)
            : "";

          item.appendChild(desc);

          item.addEventListener("click", async () => {
            document.getElementById("modal-title").textContent = a.name;
            document.getElementById("modal-desc").textContent =
              a.description || "No description provided.";
            const modalDownload = document.getElementById("modal-download");
            modalDownload.href = `${API_BASE}/api/addons/${a.id}/download`;
            modalDownload.style.display = "inline-block";

            const overlay = document.getElementById("modal-overlay");
            const box = document.getElementById("modal-box");
            const modalBody = document.querySelector(".modal-body");

            overlay.classList.add("show");
            overlay.style.opacity = "1";
            box.style.transform = "scale(1)";

            const oldPre = modalBody.querySelector("pre");
            if (oldPre) oldPre.remove();

            try {
              const contentRes = await fetch(`${API_BASE}/api/addons/${a.id}/contents`);
              const data = contentRes.ok ? await contentRes.json() : { content: "(failed to load)" };
              const pre = document.createElement("pre");
              pre.textContent = data.content || "(empty file)";
              modalBody.appendChild(pre);
            } catch {
              const pre = document.createElement("pre");
              pre.textContent = "(failed to load content)";
              modalBody.appendChild(pre);
            }
          });

          return item;
        };

        // Fill once
        // Fill ticker and duplicate until it's at least 2x viewport width
        addons.forEach(a => ticker.appendChild(createItem(a)));
        while (ticker.scrollWidth < ticker.clientWidth * 2) {
          addons.forEach(a => ticker.appendChild(createItem(a)));
        }

        let offset = 0;
        let paused = false;

        ticker.addEventListener("mouseenter", () => (paused = true));
        ticker.addEventListener("mouseleave", () => (paused = false));

        function animate() {
          if (!paused) {
            offset -= speed;
            if (Math.abs(offset) >= ticker.scrollWidth / 2) {
              offset = 0;
            }
            ticker.style.transform = `translateX(${offset}px)`;
          }
          requestAnimationFrame(animate);
        }

        animate();
      } catch (err) {
        console.error("Addon ticker error:", err);
      }
    }


    // Modal close logic
    function closeModal() {
      const overlay = document.getElementById("modal-overlay");
      const box = document.getElementById("modal-box");
      if (!overlay || !box) return;

      overlay.style.opacity = "0";
      box.style.transform = "scale(0.5)";
      overlay.addEventListener("transitionend", function handler(e) {
        if (e.propertyName === "opacity") {
          overlay.classList.remove("show");
          overlay.style.opacity = "";
          box.style.transform = "";
          overlay.removeEventListener("transitionend", handler);
        }
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      startRealAddonTicker(2);
      document.getElementById("modal-close").addEventListener("click", closeModal);
      document.getElementById("modal-overlay").addEventListener("click", e => {
        if (e.target.id === "modal-overlay") closeModal();
      });
      document.addEventListener("keydown", e => {
        if (e.key === "Escape") closeModal();
      });
    });
  </script>

  <script>
    // Hamburger menu
    const hamburger = document.querySelector('.hamburger');
    const navLinks = document.querySelector('.nav-links');
    hamburger.addEventListener('click', () => {
      navLinks.classList.toggle('active');
      hamburger.classList.toggle('open');
    });

    // Fade in on load
    window.addEventListener('load', () => {
      const fadeElements = document.querySelectorAll('.hero-text > *, .promo > *, header, footer');
      fadeElements.forEach((el, i) => {
        el.classList.add('fade-up');
        setTimeout(() => {
          el.classList.add('visible');
        }, 200 + i * 150);
      });
    });

    // Typewriter effect
    document.addEventListener('DOMContentLoaded', () => {
      const typedTextEl = document.getElementById('typedText');
      const cursorEl = document.getElementById('cursor');
      if (!typedTextEl || !cursorEl) return;

      const phrases = [
        "The best place to explore Housing and HTSL.",
        "Upload your HTSL creations easily.",
        "Keep your private HTSL code on the cloud.",
        "Download HTSL creations by other users.",
        "Found bad content? Report it using the new report feature.",
      ];

      let phraseIndex = 0;
      let charIndex = 0;
      let typing = true;

      const typingSpeed = 70;
      const deletingSpeed = 25;
      const fullTextPause = 1000;
      const totalLoopDelay = 3000;

      function typeLoop() {
        const currentText = phrases[phraseIndex];
        if (typing) {
          charIndex++;
          typedTextEl.textContent = currentText.slice(0, charIndex);
          cursorEl.classList.remove('hidden');
          if (charIndex === currentText.length) {
            typing = false;
            setTimeout(() => cursorEl.classList.add('hidden'), fullTextPause);
            setTimeout(typeLoop, totalLoopDelay);
            return;
          }
          setTimeout(typeLoop, typingSpeed);
        } else {
          charIndex--;
          typedTextEl.textContent = currentText.slice(0, charIndex);
          cursorEl.classList.remove('hidden');
          if (charIndex === 0) {
            typing = true;
            phraseIndex = (phraseIndex + 1) % phrases.length;
            setTimeout(typeLoop, 200);
            return;
          }
          setTimeout(typeLoop, deletingSpeed);
        }
      }
      typeLoop();
    });
  </script>
  <script src="script.js"></script>
</body>

</html>